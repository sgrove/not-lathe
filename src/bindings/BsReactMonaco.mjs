// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import React from "@monaco-editor/react";

var makeRange = (function(monaco, a,b,c,d) {
return new monaco.Range(a,b,c,d)
});

var setUri = (function (monaco, model1, language, newURI) {
  // Assuming model1 is the previous model
var model2 = monaco.editor.createModel(model1.getValue(), language, newURI);

var cm2 = model2._commandManager;
var cm1 = model1._commandManager;
var temp;

// SWAP currentOpenStackElement
temp = cm2.currentOpenStackElement;
cm2.currentOpenStackElement = cm1.currentOpenStackElement;
cm1.currentOpenStackElement = temp;

// SWAP past
temp = cm2.past;
cm2.past = cm1.past;
cm1.past = temp;

// SWAP future
temp = cm2.future;
cm2.future = cm1.future;
cm1.future = temp;

return model2
});

var Model = {
  setUri: setUri
};

var Editor = {
  make: React
};

function combine(ts) {
  return Belt_Array.reduce(ts, 0, (function (acc, next) {
                return acc | next;
              }));
}

var Key = {
  combine: combine
};

var options = {
  readOnly: true
};

function formatDocument(editor) {
  return Belt_Option.forEach(editor.getAction("editor.action.formatDocument"), (function (action) {
                action.run();
                
              }));
}

var Widget = {};

function transpileFile(monaco, uri, onComplete) {
  var __x = Curry._1(monaco.languages.typescript.getTypeScriptWorker, undefined);
  __x.then(function (worker) {
        var __x = Curry._1(worker, uri);
        return __x.then(function (client) {
                    var __x = Curry._1(client.getEmitOutput, uri);
                    return __x.then(function (result) {
                                return Promise.resolve(Curry._1(onComplete, result));
                              });
                  });
      });
  
}

var getSemanticDiagnostics = (function gatherDiagnostics(monaco, uri, onComplete) {
  var results = {};
  monaco.languages.typescript.getTypeScriptWorker().then((_worker) => {
    model = monaco.editor.getModel(uri);
    _worker(model.uri).then((worker) => {
      worker.getScriptFileNames().then((filename) => {
        var promises = filename.map((sf) => {
          return worker.getSemanticDiagnostics(sf).then((dd) => {
            results[sf] = dd;
          });
        });

        Promise.all(promises).then(() => onComplete(results));
      });
    });
  });
});

var addLib = (function (monaco, types, content) {
monaco.languages.typescript.typescriptDefaults.addExtraLib(
    types,
    'file:///node_modules/@types/oneGraphStudio/index.d.ts'
);
});

var TypeScript = {
  transpileFile: transpileFile,
  getSemanticDiagnostics: getSemanticDiagnostics,
  addLib: addLib
};

var registerPrettier = ((function (monaco) {
monaco.languages.registerDocumentFormattingEditProvider('typescript', {
  async provideDocumentFormattingEdits(model, options, token) {
    const prettier = await import('prettier/standalone');
    const babel = await import('prettier/parser-babel');
    const value = model.getValue();
    const text = prettier.format(value, {
      parser: 'babel',
      plugins: [babel],
      singleQuote: true,
    });

    return [
      {
        range: model.getFullModelRange(),
        text,
      },
    ];
  },
})

}));

var createWidget = (function createContentWidget(
  Monaco,
  lineNum,
  hasError,
  horizontalOffset,
  content
) {
  const widget = {
    domNode: null,
    allowEditorOverflow: true,
    getId: function () {
      return "hypercode:" + lineNum;
    },
    getPosition: function () {
      return {
        position: {
          lineNumber: lineNum,
          column: horizontalOffset
        },
        preference: [Monaco.editor.ContentWidgetPositionPreference.EXACT]
      };
    },
    getDomNode: function () {
      if (!this.domNode) {
        this.domNode = document.createElement("div");
        this.domNode.innerText = content;

        // layout
        this.domNode.style.marginLeft = "4px";
        this.domNode.style.padding = "0px 4px";
        this.domNode.style.borderRadius = "2px";

        // display
        this.domNode.style.background = !hasError ? "lightgreen" : "pink";
        this.domNode.style.color = !hasError ? "darkgreen" : "darkred";

        // HACKY: copied from monaco internal
        this.domNode.style.fontFamily = 'Menlo, Monaco, "Courier New", monospace';
        this.domNode.style.fontSize = "12px";
        this.domNode.style.lineHeight = "18px";
      }
      return this.domNode;
    }
  };

  return widget;
});

export {
  makeRange ,
  Model ,
  Editor ,
  Key ,
  options ,
  formatDocument ,
  Widget ,
  TypeScript ,
  registerPrettier ,
  createWidget ,
  
}
/* Editor Not a pure module */
