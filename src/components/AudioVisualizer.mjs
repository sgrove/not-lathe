// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Curry from "rescript/lib/es6/curry.js";
import * as Debug from "../Debug.mjs";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";

function createAudioContext(param) {
  return (function (AudioContext) { return !!AudioContext ? new AudioContext() : null})((typeof AudioContext !== "undefined" ? AudioContext : 
  typeof webkitAudioContext !== "undefined" ? webkitAudioContext :
  typeof mozAudioContext !== "undefined" ? mozAudioContext : null));
}

function monitorAudio(audio, onAudioProcess) {
  return Belt_Option.forEach(createAudioContext(undefined), (function (audioContext) {
                var analyser = Curry._3(audioContext.createScriptProcessor, 1024, 1, 1);
                var source = Curry._1(audioContext.createMediaElementSource, audio);
                Curry._1(source.connect, analyser);
                Curry._1(source.connect, audioContext.destination);
                Curry._1(analyser.connect, audioContext.destination);
                analyser.onaudioprocess = onAudioProcess;
                
              }));
}

function r(param) {
  var audio = new Audio();
  audio.crossOrigin = "anonymous";
  audio.src = "https://dl.dropboxusercontent.com/s/cnvbozzi5xhatv1/11%20Charlotte.mp3";
  Curry._1(audio.play, undefined);
  return monitorAudio(audio, (function ($$event) {
                var ints = Curry._1($$event.inputBuffer.getChannelData, 0);
                var max = Belt_Array.reduce(ints, 0, (function (acc, next) {
                        if (acc < next) {
                          return next;
                        } else {
                          return acc;
                        }
                      }));
                console.log("style.opacity", max);
                
              }));
}

Debug.assignToWindowForDeveloperDebug("audioTest", r);

export {
  createAudioContext ,
  monitorAudio ,
  r ,
  
}
/*  Not a pure module */
