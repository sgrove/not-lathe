// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Debug from "../Debug.js";
import * as Belt_Array from "bs-platform/lib/es6/belt_Array.mjs";
import * as Belt_Option from "bs-platform/lib/es6/belt_Option.mjs";

function createAudioContext(param) {
  return (function (AudioContext) { return !!AudioContext ? new AudioContext() : null})((typeof AudioContext !== "undefined" ? AudioContext : 
  typeof webkitAudioContext !== "undefined" ? webkitAudioContext :
  typeof mozAudioContext !== "undefined" ? mozAudioContext : null));
}

function monitorAudio(audio, onAudioProcess) {
  return Belt_Option.forEach(createAudioContext(undefined), (function (audioContext) {
                var analyser = audioContext.createScriptProcessor(1024, 1, 1);
                var source = audioContext.createMediaElementSource(audio);
                source.connect(analyser);
                source.connect(audioContext.destination);
                analyser.connect(audioContext.destination);
                analyser.onaudioprocess = onAudioProcess;
                
              }));
}

function r(param) {
  var audio = new Audio();
  audio.crossOrigin = "anonymous";
  audio.src = "https://dl.dropboxusercontent.com/s/cnvbozzi5xhatv1/11%20Charlotte.mp3";
  audio.play();
  return monitorAudio(audio, (function ($$event) {
                var ints = $$event.inputBuffer.getChannelData(0);
                var max = Belt_Array.reduce(ints, 0, (function (acc, next) {
                        if (acc < next) {
                          return next;
                        } else {
                          return acc;
                        }
                      }));
                console.log("style.opacity", max);
                
              }));
}

Debug.assignToWindowForDeveloperDebug("audioTest", r);

export {
  createAudioContext ,
  monitorAudio ,
  r ,
  
}
/*  Not a pure module */
